package:
  name: openrefine
  version: 3.7.5
  epoch: 0
  description: "OpenRefine is a free, open source power tool for working with messy data and improving it"
  copyright:
    - license: BSD-3-Clause
  dependencies:
    runtime:
      - openjdk-11-jre
      - bash
      - wget

environment:
  contents:
    packages:
      - wolfi-base
      - build-base
      - bash
      - openjdk-11-jre
      - openjdk-11
      - maven
      - nodejs-20
      - python-3.12

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/OpenRefine/OpenRefine
      tag: ${{package.version}}
      expected-commit: a04fb5fbd0d35d7b727bdca7d34bbca8245427d8

  - name: Build
    runs: |
      #fix script bash path
      sed -i '1s|^#!/usr/bin/env bash$|#!/bin/bash|' refine

      export JAVA_HOME=/usr/lib/jvm/java-11-openjdk
      export MVN_PARAMS="-DskipTests"
      ./refine build

      mkdir -p "${{targets.destdir}}"/usr/bin
      mkdir -p "${{targets.destdir}}"/usr/share/${{package.name}}/
      mkdir -p "${{targets.destdir}}"/usr/share/licenses/${{package.name}}/

      install -m755 LICENSE.txt "${{targets.destdir}}"/usr/share/licenses/${{package.name}}/

  - uses: strip

update:
  enabled: true
  github:
    identifier: OpenRefine/OpenRefine
    use-tag: true
